<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qlibé‡åŒ–æŠ•èµ„å¹³å°</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- åŠ è½½ä¸­å ä½ç¬¦ -->
    <div id="loading" class="app-loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">
            <h2>ğŸš€ Qlibé‡åŒ–å¹³å°</h2>
            <p>æ­£åœ¨åŠ è½½ä¸­...</p>
            <div id="loading-progress" style="margin-top: 16px; font-size: 12px; opacity: 0.8;"></div>
        </div>
    </div>
    
    <div id="root"></div>

    <!-- React åº“ -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- åº”ç”¨ä»£ç  -->
    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // æ›´æ–°åŠ è½½è¿›åº¦
        function updateProgress(step, message) {
            const progressEl = document.getElementById('loading-progress');
            if (progressEl) {
                progressEl.textContent = message;
                console.log(`${step}% - ${message}`);
            }
        }

        // Layoutç»„ä»¶
        const Layout = ({ children, currentPage, onNavigate }) => {
            const [sidebarCollapsed, setSidebarCollapsed] = useState(false);
            const [notifications, setNotifications] = useState([
                { id: 1, type: 'success', message: 'æ¨¡å‹è®­ç»ƒå®Œæˆ', time: '2åˆ†é’Ÿå‰' },
                { id: 2, type: 'info', message: 'æ•°æ®é›†æ›´æ–°', time: '15åˆ†é’Ÿå‰' }
            ]);
            const [showNotifications, setShowNotifications] = useState(false);

            const menuItems = [
                { key: 'dashboard', label: 'æ€»è§ˆ', icon: 'ğŸ“Š', desc: 'ç³»ç»Ÿæ¦‚è§ˆå’Œå¿«é€Ÿæ“ä½œ' },
                { key: 'data', label: 'æ•°æ®ç®¡ç†', icon: 'ğŸ’¾', desc: 'æ•°æ®é›†å’Œæ•°æ®æºç®¡ç†' },
                { key: 'model', label: 'æ¨¡å‹è®­ç»ƒ', icon: 'ğŸ¤–', desc: 'æ¨¡å‹é…ç½®ã€è®­ç»ƒå’Œç®¡ç†' },
                { key: 'backtest', label: 'ç­–ç•¥å›æµ‹', icon: 'ğŸ“ˆ', desc: 'ç­–ç•¥é…ç½®å’Œå›æµ‹åˆ†æ' }
            ];

            const systemStatus = {
                cpu: 65,
                memory: 78,
                disk: 45,
                network: 'online'
            };

            const clearNotification = (id) => {
                setNotifications(prev => prev.filter(n => n.id !== id));
            };

            return (
                <div className="layout">
                    {/* é¡¶éƒ¨å¯¼èˆªæ  */}
                    <header className="header">
                        <div className="header-left">
                            <button 
                                className="sidebar-toggle"
                                onClick={() => setSidebarCollapsed(!sidebarCollapsed)}
                            >
                                â˜°
                            </button>
                            <div className="logo">
                                <span className="logo-icon">ğŸ“Š</span>
                                <span className="logo-text">Qlibé‡åŒ–å¹³å°</span>
                            </div>
                        </div>
                        
                        <div className="header-center">
                            <div className="breadcrumb">
                                <span className="breadcrumb-item">
                                    {menuItems.find(item => item.key === currentPage)?.icon} {' '}
                                    {menuItems.find(item => item.key === currentPage)?.label}
                                </span>
                            </div>
                        </div>
                        
                        <div className="header-right">
                            <div className="system-indicators">
                                <div className="indicator">
                                    <span className="indicator-label">CPU</span>
                                    <div className="indicator-bar">
                                        <div className="indicator-fill" style={{width: `${systemStatus.cpu}%`}}></div>
                                    </div>
                                    <span className="indicator-value">{systemStatus.cpu}%</span>
                                </div>
                            </div>
                            
                            <div className="header-actions">
                                <div className="notification-bell" onClick={() => setShowNotifications(!showNotifications)}>
                                    ğŸ””
                                    {notifications.length > 0 && (
                                        <span className="notification-badge">{notifications.length}</span>
                                    )}
                                </div>
                                <div className="user-menu">
                                    <div className="user-avatar">ğŸ‘¤</div>
                                    <div className="user-name">ç®¡ç†å‘˜</div>
                                </div>
                            </div>
                        </div>
                    </header>

                    <div className="layout-body">
                        {/* ä¾§è¾¹æ  */}
                        <aside className={`sidebar ${sidebarCollapsed ? 'collapsed' : ''}`}>
                            <nav className="sidebar-nav">
                                {menuItems.map(item => (
                                    <div
                                        key={item.key}
                                        className={`nav-item ${currentPage === item.key ? 'active' : ''}`}
                                        onClick={() => onNavigate(item.key)}
                                        title={sidebarCollapsed ? `${item.label} - ${item.desc}` : ''}
                                    >
                                        <span className="nav-icon">{item.icon}</span>
                                        {!sidebarCollapsed && (
                                            <div className="nav-content">
                                                <span className="nav-label">{item.label}</span>
                                                <span className="nav-desc">{item.desc}</span>
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </nav>
                        </aside>

                        {/* ä¸»å†…å®¹åŒº */}
                        <main className="main-content">
                            {children}
                        </main>
                    </div>

                    {/* çŠ¶æ€æ  */}
                    <footer className="status-bar">
                        <div className="status-left">
                            <span className="status-item">ğŸŸ¢ ç³»ç»Ÿæ­£å¸¸</span>
                            <span className="status-item">ğŸ“Š å®æ—¶æ•°æ®å·²è¿æ¥</span>
                            <span className="status-item">â° {new Date().toLocaleString()}</span>
                        </div>
                        <div className="status-right">
                            <span className="status-item">ç£ç›˜: {systemStatus.disk}%</span>
                            <span className="status-item">ç½‘ç»œ: ğŸŸ¢ åœ¨çº¿</span>
                        </div>
                    </footer>

                    {/* é€šçŸ¥é¢æ¿ */}
                    {showNotifications && (
                        <div className="notification-panel">
                            <div className="notification-header">
                                <h3>é€šçŸ¥</h3>
                                <button onClick={() => setShowNotifications(false)}>Ã—</button>
                            </div>
                            <div className="notification-list">
                                {notifications.length === 0 ? (
                                    <div className="no-notifications">æš‚æ— é€šçŸ¥</div>
                                ) : (
                                    notifications.map(notification => (
                                        <div key={notification.id} className={`notification-item ${notification.type}`}>
                                            <div className="notification-content">
                                                <div className="notification-message">{notification.message}</div>
                                                <div className="notification-time">{notification.time}</div>
                                            </div>
                                            <button 
                                                className="notification-close"
                                                onClick={() => clearNotification(notification.id)}
                                            >
                                                Ã—
                                            </button>
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Dashboardç»„ä»¶
        const Dashboard = ({ tasks = [], datasets = [], models = [], onNavigate = () => {} }) => {
            const [timeRange, setTimeRange] = useState('1M');
            
            const performanceData = [
                { date: '01-01', value: 100, benchmark: 100 },
                { date: '01-15', value: 108, benchmark: 101 },
                { date: '02-01', value: 112, benchmark: 103 },
                { date: '02-15', value: 125, benchmark: 108 },
            ];

            const marketData = {
                sh000300: { value: 3456.78, change: '+1.23%', trend: 'up' },
                sz399905: { value: 6789.12, change: '-0.45%', trend: 'down' },
                sh000905: { value: 5432.10, change: '+0.67%', trend: 'up' }
            };

            const stats = {
                totalReturn: '+25.0%',
                sharpeRatio: '1.85',
                maxDrawdown: '-8.5%',
                winRate: '62.3%'
            };

            return (
                <div className="dashboard">
                    <div className="dashboard-header">
                        <h1>ğŸ  ç³»ç»Ÿæ€»è§ˆ</h1>
                        <div className="time-range-selector">
                            {['1D', '1W', '1M', '3M', '1Y'].map(range => (
                                <button 
                                    key={range}
                                    className={`time-btn ${timeRange === range ? 'active' : ''}`}
                                    onClick={() => setTimeRange(range)}
                                >
                                    {range}
                                </button>
                            ))}
                        </div>
                    </div>
                    
                    {/* å¿«é€Ÿæ“ä½œåŒºåŸŸ */}
                    <div className="quick-actions">
                        <h2>ğŸš€ å¿«é€Ÿå¼€å§‹</h2>
                        <div className="action-cards">
                            <div className="action-card" onClick={() => onNavigate('data')}>
                                <div className="action-icon">ğŸ’¾</div>
                                <div className="action-content">
                                    <h3>å‡†å¤‡æ•°æ®</h3>
                                    <p>åˆ›å»ºæ•°æ®é›†ï¼Œé€‰æ‹©è‚¡ç¥¨æ± å’Œç‰¹å¾</p>
                                </div>
                                <div className="action-arrow">â†’</div>
                            </div>
                            <div className="action-card" onClick={() => onNavigate('model')}>
                                <div className="action-icon">ğŸ¤–</div>
                                <div className="action-content">
                                    <h3>è®­ç»ƒæ¨¡å‹</h3>
                                    <p>é…ç½®å’Œè®­ç»ƒé‡åŒ–é¢„æµ‹æ¨¡å‹</p>
                                </div>
                                <div className="action-arrow">â†’</div>
                            </div>
                            <div className="action-card" onClick={() => onNavigate('backtest')}>
                                <div className="action-icon">ğŸ“ˆ</div>
                                <div className="action-content">
                                    <h3>ç­–ç•¥å›æµ‹</h3>
                                    <p>æµ‹è¯•ç­–ç•¥å†å²è¡¨ç°</p>
                                </div>
                                <div className="action-arrow">â†’</div>
                            </div>
                        </div>
                    </div>

                    {/* å¸‚åœºæ¦‚è§ˆ */}
                    <div className="market-overview">
                        <h2>ğŸ“Š å¸‚åœºæ¦‚è§ˆ</h2>
                        <div className="market-cards">
                            <div className="market-card">
                                <div className="market-name">æ²ªæ·±300</div>
                                <div className="market-value">{marketData.sh000300.value}</div>
                                <div className={`market-change ${marketData.sh000300.trend}`}>
                                    {marketData.sh000300.change}
                                </div>
                            </div>
                            <div className="market-card">
                                <div className="market-name">ä¸­è¯500</div>
                                <div className="market-value">{marketData.sz399905.value}</div>
                                <div className={`market-change ${marketData.sz399905.trend}`}>
                                    {marketData.sz399905.change}
                                </div>
                            </div>
                            <div className="market-card">
                                <div className="market-name">ä¸­è¯1000</div>
                                <div className="market-value">{marketData.sh000905.value}</div>
                                <div className={`market-change ${marketData.sh000905.trend}`}>
                                    {marketData.sh000905.change}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    {/* ç»Ÿè®¡å¡ç‰‡ */}
                    <div className="stats-section">
                        <h2>ğŸ“ˆ ç­–ç•¥è¡¨ç°</h2>
                        <div className="stats-grid">
                            <div className="stat-card">
                                <div className="stat-icon">ğŸ’°</div>
                                <div className="stat-content">
                                    <div className="stat-label">ç´¯è®¡æ”¶ç›Š</div>
                                    <div className="stat-value positive">{stats.totalReturn}</div>
                                </div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-icon">âš¡</div>
                                <div className="stat-content">
                                    <div className="stat-label">å¤æ™®æ¯”ç‡</div>
                                    <div className="stat-value">{stats.sharpeRatio}</div>
                                </div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-icon">ğŸ“‰</div>
                                <div className="stat-content">
                                    <div className="stat-label">æœ€å¤§å›æ’¤</div>
                                    <div className="stat-value negative">{stats.maxDrawdown}</div>
                                </div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-icon">ğŸ¯</div>
                                <div className="stat-content">
                                    <div className="stat-label">èƒœç‡</div>
                                    <div className="stat-value">{stats.winRate}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // é¡µé¢å ä½ç¬¦ç»„ä»¶
        const PagePlaceholder = ({ icon, title, description }) => (
            <div className="page-placeholder">
                <div className="placeholder-icon">{icon}</div>
                <h2>{title}</h2>
                <p>{description}</p>
            </div>
        );

        // ä¸»åº”ç”¨ç»„ä»¶
        const App = () => {
            const [currentPage, setCurrentPage] = useState('dashboard');
            const [tasks, setTasks] = useState([]);
            const [datasets, setDatasets] = useState([
                { id: 'ds1', name: 'æ²ªæ·±300æ—¥çº¿æ•°æ®', status: 'ready', samples: 50000, features: 20, dateRange: '2020-01-01 è‡³ 2023-12-31' },
                { id: 'ds2', name: 'ä¸­è¯500æ—¥çº¿æ•°æ®', status: 'ready', samples: 45000, features: 18, dateRange: '2020-01-01 è‡³ 2023-12-31' }
            ]);
            const [models, setModels] = useState([
                { id: 'model1', name: 'XGBoost-v1.0', type: 'XGBoost', ic: 0.045, sharpe: 1.23, status: 'trained', trainTime: '2024-01-10' },
                { id: 'model2', name: 'LightGBM-v2.0', type: 'LightGBM', ic: 0.052, sharpe: 1.35, status: 'trained', trainTime: '2024-01-12' }
            ]);

            // æ¸²æŸ“å½“å‰é¡µé¢
            const renderPage = () => {
                switch(currentPage) {
                    case 'dashboard':
                        return <Dashboard 
                            tasks={tasks} 
                            datasets={datasets} 
                            models={models}
                            onNavigate={setCurrentPage}
                        />;
                    case 'data':
                        return <PagePlaceholder 
                            icon="ğŸ’¾" 
                            title="æ•°æ®ç®¡ç†" 
                            description="æ•°æ®é›†ç®¡ç†ã€æ•°æ®æºé…ç½®å’Œæ•°æ®æ¢ç´¢åŠŸèƒ½" 
                        />;
                    case 'model':
                        return <PagePlaceholder 
                            icon="ğŸ¤–" 
                            title="æ¨¡å‹è®­ç»ƒ" 
                            description="æ¨¡å‹é…ç½®ã€è®­ç»ƒç›‘æ§å’Œæ¨¡å‹ä»“åº“ç®¡ç†åŠŸèƒ½" 
                        />;
                    case 'backtest':
                        return <PagePlaceholder 
                            icon="ğŸ“ˆ" 
                            title="ç­–ç•¥å›æµ‹" 
                            description="ç­–ç•¥é…ç½®ã€å›æµ‹æ‰§è¡Œå’Œç»“æœåˆ†æåŠŸèƒ½" 
                        />;
                    default:
                        return <Dashboard 
                            tasks={tasks} 
                            datasets={datasets} 
                            models={models}
                            onNavigate={setCurrentPage}
                        />;
                }
            };

            return (
                <Layout currentPage={currentPage} onNavigate={setCurrentPage}>
                    {renderPage()}
                </Layout>
            );
        };

        // åˆå§‹åŒ–åº”ç”¨
        function initApp() {
            try {
                updateProgress(70, 'åˆå§‹åŒ–Reactåº”ç”¨...');
                
                // éšè—åŠ è½½å±å¹•
                setTimeout(() => {
                    updateProgress(90, 'æ¸²æŸ“ç•Œé¢...');
                    document.getElementById('loading').style.display = 'none';
                    ReactDOM.render(<App />, document.getElementById('root'));
                    updateProgress(100, 'åŠ è½½å®Œæˆï¼');
                }, 500);
                
            } catch (error) {
                console.error('åº”ç”¨åˆå§‹åŒ–å¤±è´¥:', error);
                document.getElementById('loading').innerHTML = `
                    <div style="text-align: center; color: #ff4d4f;">
                        <h2>âŒ åº”ç”¨åˆå§‹åŒ–å¤±è´¥</h2>
                        <p>${error.message}</p>
                        <button onclick="window.location.reload()">é‡æ–°åŠ è½½</button>
                    </div>
                `;
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', () => {
            updateProgress(10, 'æ£€æŸ¥ç¯å¢ƒ...');
            
            if (typeof React === 'undefined') {
                throw new Error('ReactæœªåŠ è½½');
            }
            
            updateProgress(30, 'Reactç¯å¢ƒæ­£å¸¸');
            
            if (typeof ReactDOM === 'undefined') {
                throw new Error('ReactDOMæœªåŠ è½½');
            }
            
            updateProgress(50, 'å‡†å¤‡åˆå§‹åŒ–åº”ç”¨...');
            setTimeout(initApp, 200);
        });

        // é”™è¯¯å¤„ç†
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            console.error('JavaScripté”™è¯¯:', { msg, url, lineNo, columnNo, error });
            
            const loading = document.getElementById('loading');
            if (loading) {
                loading.innerHTML = `
                    <div style="text-align: center; color: #ff4d4f;">
                        <h2>âŒ åº”ç”¨é”™è¯¯</h2>
                        <p>é”™è¯¯ä¿¡æ¯: ${msg}</p>
                        <p>ä½ç½®: ${url || 'æœªçŸ¥'}:${lineNo || 0}</p>
                        <button onclick="window.location.reload()" style="
                            background: #ff4d4f; 
                            color: white; 
                            border: none; 
                            padding: 12px 24px; 
                            border-radius: 6px; 
                            cursor: pointer;
                            margin-top: 16px;
                        ">
                            é‡æ–°åŠ è½½
                        </button>
                    </div>
                `;
            }
            return false;
        };
    </script>
</body>
</html>