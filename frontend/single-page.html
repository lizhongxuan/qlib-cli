<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QlibÈáèÂåñÊäïËµÑÂπ≥Âè∞</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Âä†ËΩΩ‰∏≠Âç†‰ΩçÁ¨¶ -->
    <div id="loading" class="app-loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">
            <h2>üöÄ QlibÈáèÂåñÂπ≥Âè∞</h2>
            <p>Ê≠£Âú®Âä†ËΩΩ‰∏≠...</p>
            <div id="loading-progress" style="margin-top: 16px; font-size: 12px; opacity: 0.8;"></div>
        </div>
    </div>
    
    <div id="root"></div>

    <!-- React Â∫ì -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Â∫îÁî®‰ª£Á†Å -->
    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // Êõ¥Êñ∞Âä†ËΩΩËøõÂ∫¶
        function updateProgress(step, message) {
            const progressEl = document.getElementById('loading-progress');
            if (progressEl) {
                progressEl.textContent = message;
                console.log(`${step}% - ${message}`);
            }
        }

        // LayoutÁªÑ‰ª∂
        const Layout = ({ children, currentPage, onNavigate }) => {
            const [sidebarCollapsed, setSidebarCollapsed] = useState(false);
            const [notifications, setNotifications] = useState([
                { id: 1, type: 'success', message: 'Ê®°ÂûãËÆ≠ÁªÉÂÆåÊàê', time: '2ÂàÜÈíüÂâç' },
                { id: 2, type: 'info', message: 'Êï∞ÊçÆÈõÜÊõ¥Êñ∞', time: '15ÂàÜÈíüÂâç' }
            ]);
            const [showNotifications, setShowNotifications] = useState(false);

            const menuItems = [
                { key: 'dashboard', label: 'ÊÄªËßà', icon: 'üìä', desc: 'Á≥ªÁªüÊ¶ÇËßàÂíåÂø´ÈÄüÊìç‰Ωú' },
                { key: 'data', label: 'Êï∞ÊçÆÁÆ°ÁêÜ', icon: 'üíæ', desc: 'Êï∞ÊçÆÈõÜÂíåÊï∞ÊçÆÊ∫êÁÆ°ÁêÜ' },
                { key: 'model', label: 'Ê®°ÂûãËÆ≠ÁªÉ', icon: 'ü§ñ', desc: 'Ê®°ÂûãÈÖçÁΩÆ„ÄÅËÆ≠ÁªÉÂíåÁÆ°ÁêÜ' },
                { key: 'backtest', label: 'Á≠ñÁï•ÂõûÊµã', icon: 'üìà', desc: 'Á≠ñÁï•ÈÖçÁΩÆÂíåÂõûÊµãÂàÜÊûê' }
            ];

            const systemStatus = {
                cpu: 65,
                memory: 78,
                disk: 45,
                network: 'online'
            };

            const clearNotification = (id) => {
                setNotifications(prev => prev.filter(n => n.id !== id));
            };

            return (
                <div className="layout">
                    {/* È°∂ÈÉ®ÂØºËà™Ê†è */}
                    <header className="header">
                        <div className="header-left">
                            <button 
                                className="sidebar-toggle"
                                onClick={() => setSidebarCollapsed(!sidebarCollapsed)}
                            >
                                ‚ò∞
                            </button>
                            <div className="logo">
                                <span className="logo-icon">üìä</span>
                                <span className="logo-text">QlibÈáèÂåñÂπ≥Âè∞</span>
                            </div>
                        </div>
                        
                        <div className="header-center">
                            <div className="breadcrumb">
                                <span className="breadcrumb-item">
                                    {menuItems.find(item => item.key === currentPage)?.icon} {' '}
                                    {menuItems.find(item => item.key === currentPage)?.label}
                                </span>
                            </div>
                        </div>
                        
                        <div className="header-right">
                            <div className="system-indicators">
                                <div className="indicator">
                                    <span className="indicator-label">CPU</span>
                                    <div className="indicator-bar">
                                        <div className="indicator-fill" style={{width: `${systemStatus.cpu}%`}}></div>
                                    </div>
                                    <span className="indicator-value">{systemStatus.cpu}%</span>
                                </div>
                            </div>
                            
                            <div className="header-actions">
                                <div className="notification-bell" onClick={() => setShowNotifications(!showNotifications)}>
                                    üîî
                                    {notifications.length > 0 && (
                                        <span className="notification-badge">{notifications.length}</span>
                                    )}
                                </div>
                                <div className="user-menu">
                                    <div className="user-avatar">üë§</div>
                                    <div className="user-name">ÁÆ°ÁêÜÂëò</div>
                                </div>
                            </div>
                        </div>
                    </header>

                    <div className="layout-body">
                        {/* ‰æßËæπÊ†è */}
                        <aside className={`sidebar ${sidebarCollapsed ? 'collapsed' : ''}`}>
                            <nav className="sidebar-nav">
                                {menuItems.map(item => (
                                    <div
                                        key={item.key}
                                        className={`nav-item ${currentPage === item.key ? 'active' : ''}`}
                                        onClick={() => onNavigate(item.key)}
                                        title={sidebarCollapsed ? `${item.label} - ${item.desc}` : ''}
                                    >
                                        <span className="nav-icon">{item.icon}</span>
                                        {!sidebarCollapsed && (
                                            <div className="nav-content">
                                                <span className="nav-label">{item.label}</span>
                                                <span className="nav-desc">{item.desc}</span>
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </nav>
                        </aside>

                        {/* ‰∏ªÂÜÖÂÆπÂå∫ */}
                        <main className="main-content">
                            {children}
                        </main>
                    </div>

                    {/* Áä∂ÊÄÅÊ†è */}
                    <footer className="status-bar">
                        <div className="status-left">
                            <span className="status-item">üü¢ Á≥ªÁªüÊ≠£Â∏∏</span>
                            <span className="status-item">üìä ÂÆûÊó∂Êï∞ÊçÆÂ∑≤ËøûÊé•</span>
                            <span className="status-item">‚è∞ {new Date().toLocaleString()}</span>
                        </div>
                        <div className="status-right">
                            <span className="status-item">Á£ÅÁõò: {systemStatus.disk}%</span>
                            <span className="status-item">ÁΩëÁªú: üü¢ Âú®Á∫ø</span>
                        </div>
                    </footer>

                    {/* ÈÄöÁü•Èù¢Êùø */}
                    {showNotifications && (
                        <div className="notification-panel">
                            <div className="notification-header">
                                <h3>ÈÄöÁü•</h3>
                                <button onClick={() => setShowNotifications(false)}>√ó</button>
                            </div>
                            <div className="notification-list">
                                {notifications.length === 0 ? (
                                    <div className="no-notifications">ÊöÇÊó†ÈÄöÁü•</div>
                                ) : (
                                    notifications.map(notification => (
                                        <div key={notification.id} className={`notification-item ${notification.type}`}>
                                            <div className="notification-content">
                                                <div className="notification-message">{notification.message}</div>
                                                <div className="notification-time">{notification.time}</div>
                                            </div>
                                            <button 
                                                className="notification-close"
                                                onClick={() => clearNotification(notification.id)}
                                            >
                                                √ó
                                            </button>
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // DashboardÁªÑ‰ª∂
        const Dashboard = ({ tasks = [], datasets = [], models = [], onNavigate = () => {} }) => {
            const [timeRange, setTimeRange] = useState('1M');
            
            const performanceData = [
                { date: '01-01', value: 100, benchmark: 100 },
                { date: '01-15', value: 108, benchmark: 101 },
                { date: '02-01', value: 112, benchmark: 103 },
                { date: '02-15', value: 125, benchmark: 108 },
            ];

            const marketData = {
                sh000300: { value: 3456.78, change: '+1.23%', trend: 'up' },
                sz399905: { value: 6789.12, change: '-0.45%', trend: 'down' },
                sh000905: { value: 5432.10, change: '+0.67%', trend: 'up' }
            };

            const stats = {
                totalReturn: '+25.0%',
                sharpeRatio: '1.85',
                maxDrawdown: '-8.5%',
                winRate: '62.3%'
            };

            return (
                <div className="dashboard">
                    <div className="dashboard-header">
                        <h1>üè† Á≥ªÁªüÊÄªËßà</h1>
                        <div className="time-range-selector">
                            {['1D', '1W', '1M', '3M', '1Y'].map(range => (
                                <button 
                                    key={range}
                                    className={`time-btn ${timeRange === range ? 'active' : ''}`}
                                    onClick={() => setTimeRange(range)}
                                >
                                    {range}
                                </button>
                            ))}
                        </div>
                    </div>
                    
                    {/* Âø´ÈÄüÊìç‰ΩúÂå∫Âüü */}
                    <div className="quick-actions">
                        <h2>üöÄ Âø´ÈÄüÂºÄÂßã</h2>
                        <div className="action-cards">
                            <div className="action-card" onClick={() => onNavigate('data')}>
                                <div className="action-icon">üíæ</div>
                                <div className="action-content">
                                    <h3>ÂáÜÂ§áÊï∞ÊçÆ</h3>
                                    <p>ÂàõÂª∫Êï∞ÊçÆÈõÜÔºåÈÄâÊã©ËÇ°Á•®Ê±†ÂíåÁâπÂæÅ</p>
                                </div>
                                <div className="action-arrow">‚Üí</div>
                            </div>
                            <div className="action-card" onClick={() => onNavigate('model')}>
                                <div className="action-icon">ü§ñ</div>
                                <div className="action-content">
                                    <h3>ËÆ≠ÁªÉÊ®°Âûã</h3>
                                    <p>ÈÖçÁΩÆÂíåËÆ≠ÁªÉÈáèÂåñÈ¢ÑÊµãÊ®°Âûã</p>
                                </div>
                                <div className="action-arrow">‚Üí</div>
                            </div>
                            <div className="action-card" onClick={() => onNavigate('backtest')}>
                                <div className="action-icon">üìà</div>
                                <div className="action-content">
                                    <h3>Á≠ñÁï•ÂõûÊµã</h3>
                                    <p>ÊµãËØïÁ≠ñÁï•ÂéÜÂè≤Ë°®Áé∞</p>
                                </div>
                                <div className="action-arrow">‚Üí</div>
                            </div>
                        </div>
                    </div>

                    {/* Â∏ÇÂú∫Ê¶ÇËßà */}
                    <div className="market-overview">
                        <h2>üìä Â∏ÇÂú∫Ê¶ÇËßà</h2>
                        <div className="market-cards">
                            <div className="market-card">
                                <div className="market-name">Ê≤™Ê∑±300</div>
                                <div className="market-value">{marketData.sh000300.value}</div>
                                <div className={`market-change ${marketData.sh000300.trend}`}>
                                    {marketData.sh000300.change}
                                </div>
                            </div>
                            <div className="market-card">
                                <div className="market-name">‰∏≠ËØÅ500</div>
                                <div className="market-value">{marketData.sz399905.value}</div>
                                <div className={`market-change ${marketData.sz399905.trend}`}>
                                    {marketData.sz399905.change}
                                </div>
                            </div>
                            <div className="market-card">
                                <div className="market-name">‰∏≠ËØÅ1000</div>
                                <div className="market-value">{marketData.sh000905.value}</div>
                                <div className={`market-change ${marketData.sh000905.trend}`}>
                                    {marketData.sh000905.change}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    {/* ÁªüËÆ°Âç°Áâá */}
                    <div className="stats-section">
                        <h2>üìà Á≠ñÁï•Ë°®Áé∞</h2>
                        <div className="stats-grid">
                            <div className="stat-card">
                                <div className="stat-icon">üí∞</div>
                                <div className="stat-content">
                                    <div className="stat-label">Á¥ØËÆ°Êî∂Áõä</div>
                                    <div className="stat-value positive">{stats.totalReturn}</div>
                                </div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-icon">‚ö°</div>
                                <div className="stat-content">
                                    <div className="stat-label">Â§èÊôÆÊØîÁéá</div>
                                    <div className="stat-value">{stats.sharpeRatio}</div>
                                </div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-icon">üìâ</div>
                                <div className="stat-content">
                                    <div className="stat-label">ÊúÄÂ§ßÂõûÊí§</div>
                                    <div className="stat-value negative">{stats.maxDrawdown}</div>
                                </div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-icon">üéØ</div>
                                <div className="stat-content">
                                    <div className="stat-label">ËÉúÁéá</div>
                                    <div className="stat-value">{stats.winRate}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // È°µÈù¢Âç†‰ΩçÁ¨¶ÁªÑ‰ª∂
        const PagePlaceholder = ({ icon, title, description }) => (
            <div className="page-placeholder">
                <div className="placeholder-icon">{icon}</div>
                <h2>{title}</h2>
                <p>{description}</p>
            </div>
        );

        // ‰∏ªÂ∫îÁî®ÁªÑ‰ª∂
        const App = () => {
            const [currentPage, setCurrentPage] = useState('dashboard');
            const [tasks, setTasks] = useState([]);
            const [datasets, setDatasets] = useState([
                { id: 'ds1', name: 'Ê≤™Ê∑±300Êó•Á∫øÊï∞ÊçÆ', status: 'ready', samples: 50000, features: 20, dateRange: '2020-01-01 Ëá≥ 2023-12-31' },
                { id: 'ds2', name: '‰∏≠ËØÅ500Êó•Á∫øÊï∞ÊçÆ', status: 'ready', samples: 45000, features: 18, dateRange: '2020-01-01 Ëá≥ 2023-12-31' }
            ]);
            const [models, setModels] = useState([
                { id: 'model1', name: 'XGBoost-v1.0', type: 'XGBoost', ic: 0.045, sharpe: 1.23, status: 'trained', trainTime: '2024-01-10' },
                { id: 'model2', name: 'LightGBM-v2.0', type: 'LightGBM', ic: 0.052, sharpe: 1.35, status: 'trained', trainTime: '2024-01-12' }
            ]);

            // Ê∏≤ÊüìÂΩìÂâçÈ°µÈù¢
            const renderPage = () => {
                switch(currentPage) {
                    case 'dashboard':
                        return <Dashboard 
                            tasks={tasks} 
                            datasets={datasets} 
                            models={models}
                            onNavigate={setCurrentPage}
                        />;
                    case 'data':
                        return <PagePlaceholder 
                            icon="üíæ" 
                            title="Êï∞ÊçÆÁÆ°ÁêÜ" 
                            description="Êï∞ÊçÆÈõÜÁÆ°ÁêÜ„ÄÅÊï∞ÊçÆÊ∫êÈÖçÁΩÆÂíåÊï∞ÊçÆÊé¢Á¥¢ÂäüËÉΩ" 
                        />;
                    case 'model':
                        return <PagePlaceholder 
                            icon="ü§ñ" 
                            title="Ê®°ÂûãËÆ≠ÁªÉ" 
                            description="Ê®°ÂûãÈÖçÁΩÆ„ÄÅËÆ≠ÁªÉÁõëÊéßÂíåÊ®°Âûã‰ªìÂ∫ìÁÆ°ÁêÜÂäüËÉΩ" 
                        />;
                    case 'backtest':
                        return <PagePlaceholder 
                            icon="üìà" 
                            title="Á≠ñÁï•ÂõûÊµã" 
                            description="Á≠ñÁï•ÈÖçÁΩÆ„ÄÅÂõûÊµãÊâßË°åÂíåÁªìÊûúÂàÜÊûêÂäüËÉΩ" 
                        />;
                    default:
                        return <Dashboard 
                            tasks={tasks} 
                            datasets={datasets} 
                            models={models}
                            onNavigate={setCurrentPage}
                        />;
                }
            };

            return (
                <Layout currentPage={currentPage} onNavigate={setCurrentPage}>
                    {renderPage()}
                </Layout>
            );
        };

        // ÂàùÂßãÂåñÂ∫îÁî®
        function initApp() {
            try {
                updateProgress(70, 'ÂàùÂßãÂåñReactÂ∫îÁî®...');
                
                // ÈöêËóèÂä†ËΩΩÂ±èÂπï
                setTimeout(() => {
                    updateProgress(90, 'Ê∏≤ÊüìÁïåÈù¢...');
                    document.getElementById('loading').style.display = 'none';
                    ReactDOM.render(<App />, document.getElementById('root'));
                    updateProgress(100, 'Âä†ËΩΩÂÆåÊàêÔºÅ');
                }, 500);
                
            } catch (error) {
                console.error('Â∫îÁî®ÂàùÂßãÂåñÂ§±Ë¥•:', error);
                document.getElementById('loading').innerHTML = `
                    <div style="text-align: center; color: #ff4d4f;">
                        <h2>‚ùå Â∫îÁî®ÂàùÂßãÂåñÂ§±Ë¥•</h2>
                        <p>${error.message}</p>
                        <button onclick="window.location.reload()">ÈáçÊñ∞Âä†ËΩΩ</button>
                    </div>
                `;
            }
        }

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        window.addEventListener('load', () => {
            updateProgress(10, 'Ê£ÄÊü•ÁéØÂ¢É...');
            
            if (typeof React === 'undefined') {
                throw new Error('ReactÊú™Âä†ËΩΩ');
            }
            
            updateProgress(30, 'ReactÁéØÂ¢ÉÊ≠£Â∏∏');
            
            if (typeof ReactDOM === 'undefined') {
                throw new Error('ReactDOMÊú™Âä†ËΩΩ');
            }
            
            updateProgress(50, 'ÂáÜÂ§áÂàùÂßãÂåñÂ∫îÁî®...');
            setTimeout(initApp, 200);
        });

        // ÈîôËØØÂ§ÑÁêÜ
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            console.error('JavaScriptÈîôËØØ:', { msg, url, lineNo, columnNo, error });
            
            const loading = document.getElementById('loading');
            if (loading) {
                loading.innerHTML = `
                    <div style="text-align: center; color: #ff4d4f;">
                        <h2>‚ùå Â∫îÁî®ÈîôËØØ</h2>
                        <p>ÈîôËØØ‰ø°ÊÅØ: ${msg}</p>
                        <p>‰ΩçÁΩÆ: ${url || 'Êú™Áü•'}:${lineNo || 0}</p>
                        <button onclick="window.location.reload()" style="
                            background: #ff4d4f; 
                            color: white; 
                            border: none; 
                            padding: 12px 24px; 
                            border-radius: 6px; 
                            cursor: pointer;
                            margin-top: 16px;
                        ">
                            ÈáçÊñ∞Âä†ËΩΩ
                        </button>
                    </div>
                `;
            }
            return false;
        };
    </script>
</body>
</html>